{{ define "main" }}
<article class="py-12 md:py-16">
  <div class="section-container">
    <!-- Header -->
    <header class="mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-eethal-600 mb-4">
        {{ .Title }}
      </h1>
      {{ with .Description }}
        <p class="text-xl text-gray-600">{{ . }}</p>
      {{ end }}
    </header>

    <!-- Metadata Box -->
    {{ if .Params.metadata }}
      <div class="story-metadata mb-8">
        <h3 class="font-semibold text-lg mb-3">Story Details</h3>
        <dl class="space-y-2">
          <!-- Original Author -->
          {{ with .Params.metadata.originalAuthor }}
            <div>
              <dt class="inline font-medium">Original Author:</dt>
              <dd class="inline ml-2">{{ . }}</dd>
            </div>
          {{ end }}

          <!-- Translators -->
          {{ with .Params.metadata.translators }}
            <div>
              <dt class="inline font-medium">Translators:</dt>
              <dd class="inline ml-2">
                {{ delimit . ", " }}
              </dd>
            </div>
          {{ end }}

          <!-- Translation Date -->
          {{ with .Params.metadata.translationDate }}
            <div>
              <dt class="inline font-medium">Translation Date:</dt>
              <dd class="inline ml-2">{{ . }}</dd>
            </div>
          {{ end }}

          <!-- Age Group -->
          {{ with .Params.metadata.ageGroup }}
            <div>
              <dt class="inline font-medium">Age Group:</dt>
              <dd class="inline ml-2">
                <span class="age-badge">{{ . }}</span>
              </dd>
            </div>
          {{ end }}

          <!-- Genre -->
          {{ with .Params.metadata.genre }}
            <div>
              <dt class="inline font-medium">Genre:</dt>
              <dd class="inline ml-2">{{ . }}</dd>
            </div>
          {{ end }}

          <!-- Reading Level -->
          {{ with .Params.metadata.readingLevel }}
            <div>
              <dt class="inline font-medium">Reading Level:</dt>
              <dd class="inline ml-2">{{ . }}</dd>
            </div>
          {{ end }}

          <!-- Illustrator -->
          {{ with .Params.metadata.illustrator }}
            <div>
              <dt class="inline font-medium">Illustrator:</dt>
              <dd class="inline ml-2">{{ . }}</dd>
            </div>
          {{ end }}

          <!-- Publisher -->
          {{ with .Params.metadata.publisher }}
            <div>
              <dt class="inline font-medium">Publisher:</dt>
              <dd class="inline ml-2">{{ . }}</dd>
            </div>
          {{ end }}

          <!-- Original URL -->
          {{ with .Params.metadata.originalUrl }}
            <div>
              <dt class="inline font-medium">Original Source:</dt>
              <dd class="inline ml-2">
                <a href="{{ . }}" target="_blank" rel="noopener noreferrer" class="text-eethal-600 hover:underline">
                  {{ if $.Params.titles.english }}
                    {{ $.Params.titles.english }}
                  {{ else }}
                    {{ $.Title }}
                  {{ end }}
                </a>
              </dd>
            </div>
          {{ end }}
        </dl>
      </div>
    {{ end }}

    <!-- PDF Viewers - Tabbed Interface -->
    {{ if .Params.pdfs }}
      <div class="mb-8">
        <!-- Mobile: Button-Style Tabs with Inline Styles -->
        <div class="md:hidden" style="display: flex; gap: 8px; margin-bottom: 16px;">
          <button id="tab-tamil-mobile"
                  style="flex: 1; padding: 16px 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: 4px solid #741f8a; background-color: #741f8a; color: white; box-shadow: inset 0 4px 8px rgba(0,0,0,0.3); transition: all 0.2s;"
                  onclick="switchTab('tamil')">
            {{ if .Params.titles.tamil }}
              {{ .Params.titles.tamil }}
            {{ else }}
              Tamil
            {{ end }}
          </button>
          <button id="tab-english-mobile"
                  style="flex: 1; padding: 16px 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: 4px solid #9ca3af; background-color: white; color: #1f2937; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.2s;"
                  onclick="switchTab('english')">
            {{ if .Params.titles.english }}
              {{ .Params.titles.english }}
            {{ else }}
              English
            {{ end }}
          </button>
        </div>

        <!-- Desktop: Fancy Tab Buttons -->
        <div class="hidden md:flex">
          <button id="tab-tamil-desktop"
                  class="flex-1 py-4 px-4 md:py-5 md:px-6 text-center tab-button active text-base md:text-lg font-semibold"
                  style="border-top-left-radius: 24px; border-top-right-radius: 24px;"
                  onclick="switchTab('tamil')">
            {{ if .Params.titles.tamil }}
              {{ .Params.titles.tamil }}
            {{ else }}
              Tamil Version
            {{ end }}
          </button>
          <button id="tab-english-desktop"
                  class="flex-1 py-4 px-4 md:py-5 md:px-6 text-center tab-button inactive text-base md:text-lg font-semibold"
                  style="border-top-left-radius: 24px; border-top-right-radius: 24px;"
                  onclick="switchTab('english')">
            {{ if .Params.titles.english }}
              {{ .Params.titles.english }}
            {{ else }}
              English Version
            {{ end }}
          </button>
        </div>

        <!-- PDF Content -->
        {{ with .Params.pdfs.tamil }}
          <div id="pdf-tamil" class="pdf-viewer-container">
            <iframe src="{{ . }}"
                    width="100%"
                    height="700px"
                    style="border: none;"
                    allow="autoplay"
                    title="Tamil PDF Viewer"></iframe>
          </div>
        {{ end }}

        {{ with .Params.pdfs.english }}
          <div id="pdf-english" class="pdf-viewer-container hidden">
            <iframe src="{{ . }}"
                    width="100%"
                    height="700px"
                    style="border: none;"
                    allow="autoplay"
                    title="English PDF Viewer"></iframe>
          </div>
        {{ end }}
      </div>

      <!-- Tab Switching JavaScript -->
      <script>
      function switchTab(lang) {
        // Hide all PDFs
        const tamilPdf = document.getElementById('pdf-tamil');
        const englishPdf = document.getElementById('pdf-english');
        if (tamilPdf) tamilPdf.classList.add('hidden');
        if (englishPdf) englishPdf.classList.add('hidden');

        // Desktop tabs - Remove active state from all buttons
        const tamilDesktop = document.getElementById('tab-tamil-desktop');
        const englishDesktop = document.getElementById('tab-english-desktop');
        if (tamilDesktop) {
          tamilDesktop.classList.remove('active');
          tamilDesktop.classList.add('inactive');
        }
        if (englishDesktop) {
          englishDesktop.classList.remove('active');
          englishDesktop.classList.add('inactive');
        }

        // Mobile tabs - Update inline styles
        const tamilMobile = document.getElementById('tab-tamil-mobile');
        const englishMobile = document.getElementById('tab-english-mobile');

        // Inactive style (white background, gray border, raised)
        const inactiveStyle = 'flex: 1; padding: 16px 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: 4px solid #9ca3af; background-color: white; color: #1f2937; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.2s;';

        // Active style (purple background, purple border, pressed)
        const activeStyle = 'flex: 1; padding: 16px 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: 4px solid #741f8a; background-color: #741f8a; color: white; box-shadow: inset 0 4px 8px rgba(0,0,0,0.3); transition: all 0.2s;';

        if (lang === 'tamil') {
          if (tamilMobile) tamilMobile.style.cssText = activeStyle;
          if (englishMobile) englishMobile.style.cssText = inactiveStyle;
        } else {
          if (tamilMobile) tamilMobile.style.cssText = inactiveStyle;
          if (englishMobile) englishMobile.style.cssText = activeStyle;
        }

        // Show selected PDF
        const selectedPdf = document.getElementById('pdf-' + lang);
        if (selectedPdf) selectedPdf.classList.remove('hidden');

        // Activate selected desktop tab
        const selectedDesktop = document.getElementById('tab-' + lang + '-desktop');
        if (selectedDesktop) {
          selectedDesktop.classList.remove('inactive');
          selectedDesktop.classList.add('active');
        }
      }
      </script>
    {{ end }}

    <!-- Story Content -->
    {{ if .Content }}
      <div class="prose prose-lg max-w-none prose-eethal mt-8">
        {{ .Content }}
      </div>
    {{ end }}

    <!-- Attribution Section -->
    {{ if .Params.attribution }}
      <div class="mt-12 p-6 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
        <h3 class="text-lg font-bold text-gray-900 mb-2">
          {{ if .Params.attribution.license }}
            üìÑ Attribution Required ({{ .Params.attribution.license }})
          {{ else }}
            üìÑ Attribution
          {{ end }}
        </h3>
        <p class="text-sm text-gray-700 mb-4">
          The {{ .Params.attribution.license }} license REQUIRES that any content that is reused or repurposed must have the correct ATTRIBUTION. Please use the text below in your citations, printouts and copyright pages.
        </p>

        <!-- English Attribution -->
        {{ with .Params.attribution.englishText }}
          <div class="bg-white p-4 rounded border border-yellow-200 mb-3">
            <p class="text-sm text-gray-700 leading-relaxed">
              {{ . }}
            </p>
          </div>
        {{ end }}

        <!-- Tamil Attribution -->
        {{ with .Params.attribution.tamilText }}
          <div class="bg-white p-4 rounded border border-yellow-200">
            <p class="text-sm text-gray-700 leading-relaxed">
              {{ . }}
            </p>
          </div>
        {{ end }}

        <!-- Fallback for old format (single text field) -->
        {{ if and (not .Params.attribution.englishText) (not .Params.attribution.tamilText) }}
          {{ with .Params.attribution.text }}
            <div class="bg-white p-4 rounded border border-yellow-200">
              <p class="text-sm text-gray-700 leading-relaxed">
                {{ . }}
              </p>
            </div>
          {{ end }}
        {{ end }}

        {{ with .Params.attribution.moreInfoUrl }}
          <p class="mt-4 text-sm">
            <a href="{{ . }}" target="_blank" rel="noopener noreferrer" class="text-eethal-600 hover:underline font-medium">
              Find out more ‚Üí
            </a>
          </p>
        {{ end }}
      </div>
    {{ end }}

    <!-- Back to Stories Link -->
    <div class="mt-12 pt-8 border-t border-gray-200">
      <a href="/stories/" class="text-eethal-600 hover:text-eethal-800 font-medium">
        ‚Üê Back to All Stories
      </a>
    </div>
  </div>
</article>
{{ end }}
