{{ define "main" }}
<article class="py-12 md:py-16">
  <div class="section-container">
    <!-- Header -->
    <header class="mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-eethal-600 mb-6">
        {{ .Title }}
      </h1>

      <!-- Descriptions in styled boxes -->
      {{ if .Params.descriptions }}
        <div class="space-y-4 mb-4">
          <!-- English Description -->
          {{ with .Params.descriptions.english }}
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
              <p class="text-lg text-gray-700 text-left">{{ . }}</p>
            </div>
          {{ end }}

          <!-- Tamil Description -->
          {{ with .Params.descriptions.tamil }}
            <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded-r-lg">
              <p class="text-lg text-gray-700 text-left">{{ . }}</p>
            </div>
          {{ end }}
        </div>
      {{ else }}
        <!-- Fallback for old format -->
        {{ with .Description }}
          <p class="text-xl text-gray-600 mb-4">{{ . }}</p>
        {{ end }}
      {{ end }}

      {{ with .Params.translators }}
        <p class="text-lg text-gray-500 text-left mt-2" style="font-style: italic;">
          Translated by: {{ range $i, $t := . }}{{ if $i }}, {{ end }}<a href="/translators/{{ $t | urlize }}/" class="text-eethal-600 hover:text-eethal-800 hover:underline">{{ $t }}</a>{{ end }}
        </p>
      {{ end }}
    </header>

    <!-- PDF Viewers - Tabbed Interface -->
    {{ if .Params.pdfs }}
      <div class="mb-8">
        <!-- Mobile: Button-Style Tabs with Inline Styles -->
        <div class="flex md:hidden" style="gap: 8px; margin-bottom: 16px;">
          <button id="tab-tamil-mobile"
                  style="flex: 1; padding: 16px 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: 4px solid #741f8a; background-color: #741f8a; color: white; box-shadow: inset 0 4px 8px rgba(0,0,0,0.3); transition: all 0.2s;"
                  onclick="switchTab('tamil')">
            {{ if .Params.titles.tamil }}
              {{ .Params.titles.tamil }}
            {{ else }}
              Tamil
            {{ end }}
          </button>
          <button id="tab-english-mobile"
                  style="flex: 1; padding: 16px 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: 4px solid #9ca3af; background-color: white; color: #1f2937; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.2s;"
                  onclick="switchTab('english')">
            {{ if .Params.titles.english }}
              {{ .Params.titles.english }}
            {{ else }}
              English
            {{ end }}
          </button>
        </div>

        <!-- Desktop: Fancy Tab Buttons -->
        <div class="hidden md:flex">
          <button id="tab-tamil-desktop"
                  class="flex-1 py-4 px-4 md:py-5 md:px-6 text-center tab-button active text-base md:text-lg font-semibold"
                  style="border-top-left-radius: 24px; border-top-right-radius: 24px;"
                  onclick="switchTab('tamil')">
            {{ if .Params.titles.tamil }}
              {{ .Params.titles.tamil }}
            {{ else }}
              Tamil Version
            {{ end }}
          </button>
          <button id="tab-english-desktop"
                  class="flex-1 py-4 px-4 md:py-5 md:px-6 text-center tab-button inactive text-base md:text-lg font-semibold"
                  style="border-top-left-radius: 24px; border-top-right-radius: 24px;"
                  onclick="switchTab('english')">
            {{ if .Params.titles.english }}
              {{ .Params.titles.english }}
            {{ else }}
              English Version
            {{ end }}
          </button>
        </div>

        <!-- PDF Content -->
        {{ with .Params.pdfs.tamil }}
          <div id="pdf-tamil" class="pdf-viewer-container">
            <iframe src="{{ . }}"
                    width="100%"
                    height="700px"
                    style="border: none;"
                    allow="autoplay"
                    title="Tamil PDF Viewer"></iframe>
          </div>
        {{ end }}

        {{ with .Params.pdfs.english }}
          <div id="pdf-english" class="pdf-viewer-container hidden">
            <iframe src="{{ . }}"
                    width="100%"
                    height="700px"
                    style="border: none;"
                    allow="autoplay"
                    title="English PDF Viewer"></iframe>
          </div>
        {{ end }}
      </div>

      <!-- Tab Switching JavaScript -->
      <script>
      function switchTab(lang) {
        // Hide all PDFs
        const tamilPdf = document.getElementById('pdf-tamil');
        const englishPdf = document.getElementById('pdf-english');
        if (tamilPdf) tamilPdf.classList.add('hidden');
        if (englishPdf) englishPdf.classList.add('hidden');

        // Desktop tabs - Remove active state from all buttons
        const tamilDesktop = document.getElementById('tab-tamil-desktop');
        const englishDesktop = document.getElementById('tab-english-desktop');
        if (tamilDesktop) {
          tamilDesktop.classList.remove('active');
          tamilDesktop.classList.add('inactive');
        }
        if (englishDesktop) {
          englishDesktop.classList.remove('active');
          englishDesktop.classList.add('inactive');
        }

        // Mobile tabs - Update inline styles
        const tamilMobile = document.getElementById('tab-tamil-mobile');
        const englishMobile = document.getElementById('tab-english-mobile');

        // Inactive style (white background, gray border, raised)
        const inactiveStyle = 'flex: 1; padding: 16px 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: 4px solid #9ca3af; background-color: white; color: #1f2937; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.2s;';

        // Active style (purple background, purple border, pressed)
        const activeStyle = 'flex: 1; padding: 16px 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: 4px solid #741f8a; background-color: #741f8a; color: white; box-shadow: inset 0 4px 8px rgba(0,0,0,0.3); transition: all 0.2s;';

        if (lang === 'tamil') {
          if (tamilMobile) tamilMobile.style.cssText = activeStyle;
          if (englishMobile) englishMobile.style.cssText = inactiveStyle;
        } else {
          if (tamilMobile) tamilMobile.style.cssText = inactiveStyle;
          if (englishMobile) englishMobile.style.cssText = activeStyle;
        }

        // Show selected PDF
        const selectedPdf = document.getElementById('pdf-' + lang);
        if (selectedPdf) selectedPdf.classList.remove('hidden');

        // Activate selected desktop tab
        const selectedDesktop = document.getElementById('tab-' + lang + '-desktop');
        if (selectedDesktop) {
          selectedDesktop.classList.remove('inactive');
          selectedDesktop.classList.add('active');
        }
      }
      </script>
    {{ end }}

    <!-- Story Content -->
    {{ if .Content }}
      <div class="prose prose-story prose-lg max-w-none prose-eethal mt-8">
        {{ .Content }}
      </div>
    {{ end }}

    <!-- Back to Stories Link -->
    <div class="mt-12 pt-8 border-t border-gray-200">
      <a href="/stories/" class="text-eethal-600 hover:text-eethal-800 font-medium">
        ‚Üê Back to All Stories
      </a>
    </div>
  </div>
</article>
{{ end }}
